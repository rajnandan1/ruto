!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ruto={})}(this,(function(e){"use strict";function t(e){if(e.startsWith("*"))return"*";if(e.startsWith("/"))return"";const t=document.createElement("a");return t.href=e,t.origin}function i(e){const i=t(e),n=e.replace(i,"").split("/")[1];return n.startsWith("parent")?"parent":n.startsWith("iframe")?"iframe":n.startsWith("window")?"window":"parent"}function n(e){const i=t(e),n=e.replace(i,"").split("/")[1];return n.endsWith("parent")?"parent":n.endsWith("iframe")?"iframe":n.endsWith("window")?"window":"iframe"}function s(e){const i=t(e),n=e.replace(i,"");if(!n.startsWith("/"))return!1;const s=n.split("/");if(3!=s.length)return!1;const o=s[1];return!!(o.startsWith("parent")||o.startsWith("iframe")||o.startsWith("window"))&&(!(o.startsWith("parent")&&!o.endsWith("iframe")&&!o.endsWith("window"))&&!((o.startsWith("iframe")||o.startsWith("window"))&&!o.endsWith("parent")))}class o{constructor(e,s,o){this.send=e=>new Promise(((t,i)=>{var n;if(this.resolver=t,this.rejecter=i,null==this.client.node||null==this.client.node)return i("Client Unhealthy");try{const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),i={message:e,subpath:this.client.subpath,id:t,fromOrigin:this.client.fromOrigin,toOrigin:this.client.toOrigin,nodeTypeTo:this.client.nodeTypeTo,nodeTypeFrom:this.client.nodeTypeFrom};if("iframe"==this.client.nodeTypeTo){null===(n=this.client.node.contentWindow)||void 0===n||n.postMessage(i,this.client.toOrigin)}else if("parent"==this.client.nodeTypeTo){this.client.node.postMessage(i,this.client.toOrigin)}else if("window"==this.client.nodeTypeTo){this.client.node.postMessage(i,this.client.toOrigin)}const s=setTimeout((()=>{this.rejecter("Timeout"),window.removeEventListener("message",o)}),this.timeout),o=e=>{var i;"*"!=e.data.fromOrigin&&e.origin!==e.data.fromOrigin||(null===(i=e.data)||void 0===i?void 0:i.subpath)===this.client.subpath&&e.data.id===t&&(this.resolver(e.data.message),window.removeEventListener("message",o),clearTimeout(s))};window.addEventListener("message",o)}catch(e){this.rejecter(e)}}));const r=t(e);this.client={node:s,nodeTypeTo:n(e),nodeTypeFrom:i(e),toOrigin:r,fromOrigin:t(window.location.href),subpath:e.replace(r,"")},this.timeout=(null==o?void 0:o.timeout)||3e3,this.resolver=e=>{},this.rejecter=e=>{}}}class r{constructor(e,t){this.send=e=>{var t;const i={id:this.messageId,message:e,fromOrigin:this.client.fromOrigin,toOrigin:this.client.toOrigin,nodeTypeTo:this.client.nodeTypeTo,nodeTypeFrom:this.client.nodeTypeFrom,subpath:this.client.subpath};let n=this.client.nodeTypeFrom,s=this.client.nodeTypeTo;if("iframe"==n&&"parent"==s){this.client.node.postMessage(i,this.client.toOrigin)}else if("parent"==n&&"iframe"==s){null===(t=this.client.node.contentWindow)||void 0===t||t.postMessage(i,this.client.toOrigin)}else if("window"==n&&"parent"==s){this.client.node.postMessage(i,this.client.toOrigin)}else if("parent"==n&&"window"==s){this.client.node.postMessage(i,this.client.toOrigin)}},this.messageId=e,this.client=t}}class a{constructor(){this.receive=(e,t,i)=>{window.addEventListener("message",(n=>{var s;if(n.origin!==n.data.fromOrigin)return;if((null===(s=n.data)||void 0===s?void 0:s.subpath)!==e)return;if("parent"==n.data.nodeTypeFrom&&"window"==n.data.nodeTypeTo&&n.source!=t)return;const o={node:t,nodeTypeTo:n.data.nodeTypeFrom,nodeTypeFrom:n.data.nodeTypeTo,toOrigin:n.data.fromOrigin,fromOrigin:n.data.toOrigin,subpath:e},a=new r(n.data.id,o);i(a,n.data.message)}))}}}e.receive=function(e,t,i){if(!s(e))throw new Error("Invalid Path");(new a).receive(e,t,i)},e.send=function(e,t,i,n){if(!s(e))throw new Error("Invalid Path");return new o(e,t,n).send(i)}}));
//# sourceMappingURL=ruto.min.js.map
